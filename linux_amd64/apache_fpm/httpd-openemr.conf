# Apache Virtual Host Configuration for OpenEMR on Linux (arm64)
# 
# This configuration uses the static PHP CGI binary to execute PHP files via a wrapper script.

# Update OPENEMR_PATH to match your installation
Define OPENEMR_PATH /path/to/openemr-extracted

<VirtualHost *:80>
    ServerName localhost
    DocumentRoot "${OPENEMR_PATH}"
    
    # Enable mod_rewrite for redirects
    RewriteEngine On
    
    # Redirect root to index.php if no file is specified
    RewriteRule ^$ /index.php [L]
    
    # Proxy PHP requests to PHP-FPM
    <FilesMatch \.php$>
        SetHandler "proxy:fcgi://127.0.0.1:9000"
    </FilesMatch>

    # Optimization for Heavy Load
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>

    KeepAlive On
    MaxKeepAliveRequests 100
    KeepAliveTimeout 5

    # Directory configuration
    <Directory "${OPENEMR_PATH}">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
        
    # Security: Prevent access to sensitive files
    <FilesMatch "\.(git|sql|ini|log|json|lock|md)$">
        Require all denied
    </FilesMatch>
    
    # Deny access to hidden files
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
</Directory>

# Logging (Linux/Debian/Ubuntu default paths)
    ErrorLog ${APACHE_LOG_DIR}/openemr-error.log
    CustomLog ${APACHE_LOG_DIR}/openemr-access.log common
</VirtualHost>
